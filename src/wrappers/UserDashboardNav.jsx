import "../styles/UserDashboardNav.css";
import React, { useEffect, useState } from "react";
import userServices from "../../services/userServices";
import {
  Link,
  NavLink,
  Outlet,
  redirect,
  useLoaderData,
  useNavigate,
} from "react-router-dom";
import Sidebar from "../components/Sidebar";
import reuniteMeLogo from "../assets/reuniteme_logo.svg";
import { toast } from "react-toastify";

export async function loader() {
  try {
    const user = await userServices.getCurrentUser();

    return { user };
  } catch (error) {
    toast.error(error.response.data.message);

    return redirect("/");
  }
}

export const getUserCategoryLabel = (category) => {
  switch (category) {
    case "communityUploader":
      return "Reunite Contributor";
    case "reuniteSeeker":
      return "Reunite Seeker";
    case "admin":
      return "Admin";

    default:
      return category;
  }
};

const UserDashboardNav = () => {
  const navigate = useNavigate();
  const [isAreaExpanded, setIsAreaExpanded] = useState(false);

  const { user } = useLoaderData();

  const handleLogout = async () => {
    try {
      const response = await userServices.logout();

      if (response.status === 204) {
        toast.success("Logged out successfully!");
        navigate("/");
      } else {
        response.data.message;
      }
    } catch (error) {
      // console.log(error);
      toast.error(error?.response?.data?.message || "An error occured");
    }
  };

  const handleNavButton = () => {
    setIsAreaExpanded((prev) => !prev);
  };

  return (
    <>
      <div className="navbar navbar-expand-lg sticky-top">
        <div className="container  px-4 ">
          <NavLink className="navbar-brand d-flex align-items-center gap-4">
            <svg
              width="48"
              height="48"
              viewBox="0 0 160 159"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M75 9C116.421 9 150 42.5786 150 84C150 125.421 116.421 159 75 159C33.5786 159 0 125.421 0 84C0 42.5786 33.5786 9 75 9Z"
                fill="#5C0DAB"
                fill-opacity="0.12"
              />
              <path
                d="M85 0C126.421 3.87444e-05 160 33.5787 160 75C160 116.421 126.421 150 85 150C43.5786 150 10 116.421 10 75C10 33.5786 43.5786 0 85 0Z"
                fill="#5C0DAB"
                fill-opacity="0.2"
              />
              <path
                d="M63 92V45.4545H83.0909C86.5455 45.4545 89.5682 46.0833 92.1591 47.3409C94.75 48.5985 96.7652 50.4091 98.2045 52.7727C99.6439 55.1364 100.364 57.9697 100.364 61.2727C100.364 64.6061 99.6212 67.4167 98.1364 69.7045C96.6667 71.9924 94.5985 73.7197 91.9318 74.8864C89.2803 76.053 86.1818 76.6364 82.6364 76.6364H70.6364V66.8182H80.0909C81.5758 66.8182 82.8409 66.6364 83.8864 66.2727C84.947 65.8939 85.7576 65.2955 86.3182 64.4773C86.8939 63.6591 87.1818 62.5909 87.1818 61.2727C87.1818 59.9394 86.8939 58.8561 86.3182 58.0227C85.7576 57.1742 84.947 56.553 83.8864 56.1591C82.8409 55.75 81.5758 55.5455 80.0909 55.5455H75.6364V92H63ZM90.2727 70.6364L101.909 92H88.1818L76.8182 70.6364H90.2727Z"
                fill="#42236F"
              />
              <path
                d="M28.6037 116V110.545H30.0703V111.497H30.1271C30.2266 111.159 30.3935 110.903 30.6278 110.73C30.8622 110.555 31.1321 110.467 31.4375 110.467C31.5133 110.467 31.5949 110.472 31.6825 110.482C31.7701 110.491 31.8471 110.504 31.9134 110.521V111.863C31.8423 111.842 31.7441 111.823 31.6186 111.806C31.4931 111.79 31.3783 111.781 31.2741 111.781C31.0516 111.781 30.8527 111.83 30.6776 111.927C30.5047 112.022 30.3674 112.154 30.2656 112.325C30.1662 112.495 30.1165 112.692 30.1165 112.914V116H28.6037ZM37.4957 116.107C36.9347 116.107 36.4517 115.993 36.0469 115.766C35.6444 115.536 35.3343 115.212 35.1165 114.793C34.8987 114.371 34.7898 113.873 34.7898 113.298C34.7898 112.737 34.8987 112.244 35.1165 111.82C35.3343 111.397 35.6409 111.066 36.0362 110.83C36.4339 110.593 36.9003 110.474 37.4354 110.474C37.7952 110.474 38.1302 110.532 38.4403 110.648C38.7528 110.762 39.0251 110.934 39.2571 111.163C39.4915 111.393 39.6738 111.682 39.804 112.03C39.9342 112.375 39.9993 112.78 39.9993 113.244V113.66H35.3935V112.722H38.5753C38.5753 112.504 38.5279 112.312 38.4332 112.143C38.3385 111.975 38.2071 111.844 38.0391 111.749C37.8733 111.652 37.6804 111.604 37.4602 111.604C37.2306 111.604 37.027 111.657 36.8494 111.763C36.6742 111.868 36.5369 112.009 36.4375 112.186C36.3381 112.361 36.2872 112.557 36.2848 112.772V113.663C36.2848 113.933 36.3345 114.166 36.4339 114.363C36.5357 114.559 36.679 114.711 36.8636 114.817C37.0483 114.924 37.2673 114.977 37.5206 114.977C37.6887 114.977 37.8426 114.954 37.9822 114.906C38.1219 114.859 38.2415 114.788 38.3409 114.693C38.4403 114.598 38.5161 114.482 38.5682 114.345L39.9673 114.438C39.8963 114.774 39.7507 115.067 39.5305 115.318C39.3127 115.567 39.031 115.761 38.6854 115.901C38.3421 116.038 37.9455 116.107 37.4957 116.107ZM46.7988 113.678V110.545H48.3116V116H46.8592V115.009H46.8024C46.6793 115.329 46.4745 115.586 46.188 115.78C45.9039 115.974 45.5571 116.071 45.1475 116.071C44.783 116.071 44.4622 115.988 44.1852 115.822C43.9082 115.657 43.6916 115.421 43.5353 115.116C43.3815 114.81 43.3033 114.445 43.301 114.018V110.545H44.8137V113.749C44.8161 114.071 44.9025 114.325 45.073 114.512C45.2434 114.699 45.4719 114.793 45.7583 114.793C45.9406 114.793 46.1111 114.751 46.2697 114.668C46.4283 114.583 46.5562 114.458 46.6532 114.292C46.7527 114.126 46.8012 113.921 46.7988 113.678ZM53.3489 112.847V116H51.8361V110.545H53.2779V111.508H53.3418C53.4625 111.191 53.665 110.94 53.949 110.755C54.2331 110.568 54.5776 110.474 54.9824 110.474C55.3612 110.474 55.6915 110.557 55.9732 110.723C56.2549 110.889 56.4739 111.125 56.6301 111.433C56.7864 111.739 56.8645 112.103 56.8645 112.527V116H55.3517V112.797C55.3541 112.463 55.2689 112.203 55.0961 112.016C54.9232 111.826 54.6853 111.732 54.3823 111.732C54.1787 111.732 53.9988 111.775 53.8425 111.863C53.6886 111.951 53.5679 112.078 53.4803 112.246C53.3951 112.412 53.3513 112.612 53.3489 112.847ZM60.3713 116V110.545H61.8841V116H60.3713ZM61.1312 109.842C60.9063 109.842 60.7134 109.768 60.5524 109.619C60.3938 109.467 60.3145 109.286 60.3145 109.075C60.3145 108.867 60.3938 108.688 60.5524 108.539C60.7134 108.388 60.9063 108.312 61.1312 108.312C61.3561 108.312 61.5479 108.388 61.7065 108.539C61.8675 108.688 61.948 108.867 61.948 109.075C61.948 109.286 61.8675 109.467 61.7065 109.619C61.5479 109.768 61.3561 109.842 61.1312 109.842ZM68.3116 110.545V111.682H65.0268V110.545H68.3116ZM65.7725 109.239H67.2853V114.324C67.2853 114.464 67.3066 114.572 67.3493 114.651C67.3919 114.726 67.4511 114.78 67.5268 114.81C67.6049 114.841 67.6949 114.857 67.7967 114.857C67.8677 114.857 67.9387 114.851 68.0098 114.839C68.0808 114.825 68.1352 114.814 68.1731 114.807L68.411 115.933C68.3353 115.956 68.2288 115.983 68.0914 116.014C67.9541 116.047 67.7872 116.067 67.5907 116.075C67.2261 116.089 66.9065 116.04 66.6319 115.929C66.3597 115.818 66.1478 115.645 65.9963 115.411C65.8448 115.176 65.7702 114.88 65.7725 114.523V109.239ZM74.0973 116.107C73.5362 116.107 73.0533 115.993 72.6484 115.766C72.246 115.536 71.9358 115.212 71.718 114.793C71.5002 114.371 71.3913 113.873 71.3913 113.298C71.3913 112.737 71.5002 112.244 71.718 111.82C71.9358 111.397 72.2424 111.066 72.6378 110.83C73.0355 110.593 73.5019 110.474 74.0369 110.474C74.3968 110.474 74.7318 110.532 75.0419 110.648C75.3544 110.762 75.6267 110.934 75.8587 111.163C76.093 111.393 76.2753 111.682 76.4055 112.03C76.5357 112.375 76.6009 112.78 76.6009 113.244V113.66H71.995V112.722H75.1768C75.1768 112.504 75.1295 112.312 75.0348 112.143C74.9401 111.975 74.8087 111.844 74.6406 111.749C74.4749 111.652 74.282 111.604 74.0618 111.604C73.8321 111.604 73.6286 111.657 73.451 111.763C73.2758 111.868 73.1385 112.009 73.0391 112.186C72.9396 112.361 72.8887 112.557 72.8864 112.772V113.663C72.8864 113.933 72.9361 114.166 73.0355 114.363C73.1373 114.559 73.2805 114.711 73.4652 114.817C73.6499 114.924 73.8688 114.977 74.1222 114.977C74.2902 114.977 74.4441 114.954 74.5838 114.906C74.7235 114.859 74.843 114.788 74.9425 114.693C75.0419 114.598 75.1177 114.482 75.1697 114.345L76.5689 114.438C76.4979 114.774 76.3523 115.067 76.1321 115.318C75.9143 115.567 75.6326 115.761 75.2869 115.901C74.9437 116.038 74.5471 116.107 74.0973 116.107ZM82.217 116V110.545H83.6587V111.508H83.7227C83.8363 111.188 84.0257 110.936 84.2908 110.751C84.556 110.567 84.8732 110.474 85.2425 110.474C85.6166 110.474 85.935 110.568 86.1978 110.755C86.4606 110.94 86.6358 111.191 86.7234 111.508H86.7802C86.8915 111.195 87.0927 110.946 87.3839 110.759C87.6774 110.569 88.0243 110.474 88.4244 110.474C88.9334 110.474 89.3465 110.637 89.6637 110.961C89.9833 111.283 90.1431 111.74 90.1431 112.332V116H88.6339V112.63C88.6339 112.327 88.5534 112.1 88.3924 111.948C88.2314 111.797 88.0302 111.721 87.7887 111.721C87.5141 111.721 87.2998 111.808 87.146 111.984C86.9921 112.156 86.9151 112.385 86.9151 112.669V116H85.4485V112.598C85.4485 112.33 85.3716 112.117 85.2177 111.959C85.0662 111.8 84.8661 111.721 84.6175 111.721C84.4495 111.721 84.2979 111.763 84.163 111.849C84.0304 111.932 83.9251 112.049 83.8469 112.2C83.7688 112.349 83.7298 112.525 83.7298 112.726V116H82.217ZM93.6525 116V110.545H95.1653V116H93.6525ZM94.4125 109.842C94.1876 109.842 93.9946 109.768 93.8336 109.619C93.675 109.467 93.5957 109.286 93.5957 109.075C93.5957 108.867 93.675 108.688 93.8336 108.539C93.9946 108.388 94.1876 108.312 94.4125 108.312C94.6374 108.312 94.8291 108.388 94.9877 108.539C95.1487 108.688 95.2292 108.867 95.2292 109.075C95.2292 109.286 95.1487 109.467 94.9877 109.619C94.8291 109.768 94.6374 109.842 94.4125 109.842ZM103.23 112.101L101.845 112.186C101.821 112.068 101.77 111.961 101.692 111.866C101.614 111.769 101.511 111.692 101.383 111.636C101.258 111.576 101.108 111.547 100.932 111.547C100.698 111.547 100.5 111.597 100.339 111.696C100.178 111.793 100.098 111.923 100.098 112.087C100.098 112.217 100.15 112.327 100.254 112.417C100.358 112.507 100.537 112.579 100.79 112.634L101.778 112.832C102.308 112.941 102.703 113.116 102.964 113.358C103.224 113.599 103.354 113.917 103.354 114.31C103.354 114.667 103.249 114.981 103.038 115.251C102.83 115.521 102.543 115.731 102.179 115.883C101.817 116.032 101.399 116.107 100.925 116.107C100.203 116.107 99.6279 115.956 99.1994 115.656C98.7733 115.353 98.5235 114.941 98.4501 114.42L99.938 114.342C99.983 114.562 100.092 114.73 100.265 114.846C100.438 114.96 100.659 115.016 100.929 115.016C101.194 115.016 101.407 114.965 101.568 114.864C101.731 114.759 101.814 114.626 101.817 114.462C101.814 114.325 101.756 114.213 101.643 114.125C101.529 114.035 101.354 113.966 101.117 113.919L100.172 113.731C99.6397 113.624 99.2432 113.44 98.9828 113.177C98.7247 112.914 98.5957 112.579 98.5957 112.172C98.5957 111.821 98.6904 111.52 98.8798 111.266C99.0716 111.013 99.3403 110.818 99.6859 110.68C100.034 110.543 100.441 110.474 100.907 110.474C101.596 110.474 102.139 110.62 102.534 110.911C102.932 111.202 103.164 111.599 103.23 112.101ZM111.16 112.101L109.775 112.186C109.751 112.068 109.7 111.961 109.622 111.866C109.544 111.769 109.441 111.692 109.313 111.636C109.188 111.576 109.037 111.547 108.862 111.547C108.628 111.547 108.43 111.597 108.269 111.696C108.108 111.793 108.028 111.923 108.028 112.087C108.028 112.217 108.08 112.327 108.184 112.417C108.288 112.507 108.467 112.579 108.72 112.634L109.707 112.832C110.238 112.941 110.633 113.116 110.893 113.358C111.154 113.599 111.284 113.917 111.284 114.31C111.284 114.667 111.179 114.981 110.968 115.251C110.76 115.521 110.473 115.731 110.108 115.883C109.746 116.032 109.328 116.107 108.855 116.107C108.133 116.107 107.558 115.956 107.129 115.656C106.703 115.353 106.453 114.941 106.38 114.42L107.868 114.342C107.913 114.562 108.022 114.73 108.194 114.846C108.367 114.96 108.589 115.016 108.858 115.016C109.124 115.016 109.337 114.965 109.498 114.864C109.661 114.759 109.744 114.626 109.746 114.462C109.744 114.325 109.686 114.213 109.572 114.125C109.459 114.035 109.283 113.966 109.047 113.919L108.102 113.731C107.569 113.624 107.173 113.44 106.912 113.177C106.654 112.914 106.525 112.579 106.525 112.172C106.525 111.821 106.62 111.52 106.809 111.266C107.001 111.013 107.27 110.818 107.616 110.68C107.964 110.543 108.371 110.474 108.837 110.474C109.526 110.474 110.068 110.62 110.464 110.911C110.861 111.202 111.093 111.599 111.16 112.101ZM114.551 116V110.545H116.064V116H114.551ZM115.311 109.842C115.086 109.842 114.893 109.768 114.732 109.619C114.573 109.467 114.494 109.286 114.494 109.075C114.494 108.867 114.573 108.688 114.732 108.539C114.893 108.388 115.086 108.312 115.311 108.312C115.536 108.312 115.728 108.388 115.886 108.539C116.047 108.688 116.128 108.867 116.128 109.075C116.128 109.286 116.047 109.467 115.886 109.619C115.728 109.768 115.536 109.842 115.311 109.842ZM121.103 112.847V116H119.59V110.545H121.032V111.508H121.096C121.216 111.191 121.419 110.94 121.703 110.755C121.987 110.568 122.331 110.474 122.736 110.474C123.115 110.474 123.445 110.557 123.727 110.723C124.009 110.889 124.228 111.125 124.384 111.433C124.54 111.739 124.618 112.103 124.618 112.527V116H123.106V112.797C123.108 112.463 123.023 112.203 122.85 112.016C122.677 111.826 122.439 111.732 122.136 111.732C121.933 111.732 121.753 111.775 121.596 111.863C121.443 111.951 121.322 112.078 121.234 112.246C121.149 112.412 121.105 112.612 121.103 112.847ZM130.583 118.159C130.093 118.159 129.672 118.092 129.322 117.957C128.974 117.824 128.697 117.643 128.491 117.413C128.285 117.184 128.151 116.926 128.09 116.639L129.489 116.451C129.531 116.56 129.599 116.662 129.691 116.756C129.784 116.851 129.905 116.927 130.057 116.984C130.211 117.043 130.398 117.072 130.618 117.072C130.947 117.072 131.218 116.992 131.431 116.831C131.647 116.672 131.754 116.406 131.754 116.032V115.034H131.691C131.624 115.186 131.525 115.329 131.392 115.464C131.26 115.599 131.089 115.709 130.881 115.794C130.673 115.879 130.424 115.922 130.135 115.922C129.726 115.922 129.353 115.827 129.017 115.638C128.683 115.446 128.416 115.154 128.218 114.761C128.021 114.365 127.923 113.866 127.923 113.262C127.923 112.644 128.023 112.128 128.225 111.714C128.426 111.299 128.693 110.989 129.027 110.783C129.363 110.577 129.731 110.474 130.132 110.474C130.437 110.474 130.693 110.527 130.899 110.631C131.105 110.732 131.27 110.86 131.396 111.014C131.524 111.166 131.622 111.315 131.691 111.462H131.747V110.545H133.249V116.053C133.249 116.517 133.136 116.906 132.909 117.218C132.681 117.531 132.366 117.765 131.964 117.921C131.564 118.08 131.103 118.159 130.583 118.159ZM130.615 114.786C130.858 114.786 131.064 114.725 131.232 114.604C131.403 114.481 131.533 114.306 131.623 114.079C131.715 113.849 131.762 113.575 131.762 113.255C131.762 112.935 131.717 112.658 131.627 112.424C131.537 112.187 131.406 112.004 131.236 111.874C131.066 111.743 130.858 111.678 130.615 111.678C130.366 111.678 130.156 111.746 129.986 111.881C129.816 112.013 129.686 112.198 129.599 112.435C129.511 112.671 129.468 112.945 129.468 113.255C129.468 113.57 129.511 113.842 129.599 114.072C129.689 114.299 129.818 114.475 129.986 114.601C130.156 114.724 130.366 114.786 130.615 114.786Z"
                fill="black"
              />
              <line x1="25" y1="102.5" x2="144" y2="102.5" stroke="#140623" />
            </svg>
            <h2 className="h5 mb-0">ReUniteME</h2>
          </NavLink>

          <button
            className="navbar-toggler"
            aria-controls="navbarNav"
            aria-expanded="false"
            aria-label="Toggle navigation"
            data-bs-target="#navbarNav"
            data-bs-toggle="collapse"
            type="button"
          >
            <span className="navbar-toggler-icon"></span>
          </button>
          <div className="collapse navbar-collapse" id="navbarNav">
            <ul className="navbar-nav mx-auto">
              <li className="nav-item">
                <a
                  className="nav-link disabled user-logged"
                  aria-disabled="true"
                >
                  <h6 className="user-logged">
                    Welcome {user.data.user.firstname} {user.data.user.lastname}
                  </h6>
                </a>
              </li>
            </ul>
            <button
              className="btn btn-outline-primary px-4"
              onClick={handleLogout}
            >
              Logout
            </button>
          </div>
        </div>
      </div>

      <div className="mx-auto m-4 text-end p-4 user-logged">
        {getUserCategoryLabel(user.data.user.userCategory)}
      </div>

      <div className="container mx-auto">
        <div className="row">
          <aside className="col-12 col-md-3 mb-4 mb-md-0 ">
            <Sidebar userType={user.data.user.userCategory} />
          </aside>
          <div className="col-12 col-md-9">
            <Outlet />
          </div>
        </div>
      </div>
    </>
  );
};

export default UserDashboardNav;
